<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NHC Ping Monitor</title>
  <meta http-equiv="refresh" content="15">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --border: #e2e8f0;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --primary: #3b82f6;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --radius: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 1rem;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }
    .header p {
      color: var(--text-light);
      font-size: 0.95rem;
      margin-top: 0.25rem;
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      font-size: 0.9rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .status-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%; display: inline-block;
    }
    .dot.active { background: var(--success); }
    .dot.inactive { background: var(--danger); }

    /* Search Box */
    .search-box {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    #regionSearch {
      padding: 0.75rem 1rem;
      font: 1rem 'Inter', sans-serif;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
      width: 100%;
      max-width: 360px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      outline: none;
      transition: all 0.2s;
    }
    #regionSearch:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Region Card */
    .region-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.4s ease-out forwards;
    }
    .region-card.hidden { display: none; }
    .region-card h2 {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .region-card h2::before {
      content: "";
      width: 8px; height: 8px;
      background: var(--primary);
      border-radius: 50%;
      display: inline-block;
    }

    /* Table */
    .table-wrapper { overflow-x: auto; border-radius: 8px; }
    table {
      width: 100%;
      min-width: 340px;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    th {
      background: #f1f5f9;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      padding: 0.75rem 0.5rem;
      text-align: left;
      color: #475569;
    }
    td {
      padding: 0.75rem 0.5rem;
      border-bottom: 1px solid var(--border);
    }
    tr:last-child td { border-bottom: none; }

    /* Status Badge */
    .status {
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
    }
    .status.active {
      background: #d1fae5;
      color: var(--success);
    }
    .status.inactive {
      background: #fee2e2;
      color: var(--danger);
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 1.5rem;
      color: var(--text-light);
      font-size: 0.85rem;
      margin-top: 2rem;
    }

    /* Animations */
    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    /* Mobile */
    @media (max-width: 640px) {
      .header h1 { font-size: 1.5rem; }
      .status-bar { flex-direction: column; text-align: center; }
      .status-item { justify-content: center; }
      th, td { padding: 0.5rem 0.4rem; font-size: 0.8rem; }
      .region-card h2 { font-size: 1.1rem; }
      #regionSearch { max-width: none; }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <div class="header">
      <h1>NHC Ping Monitor</h1>
      <p><em>Real-time network status from local infrastructure</em></p>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item" onclick="showOnly('active')" style="cursor:pointer;">
      <span class="dot active"></span>
      <span id="active-count">0</span> Active
    </div>

    <div class="status-item" onclick="showOnly('inactive')" style="cursor:pointer;">
      <span class="dot inactive"></span>
      <span id="inactive-count">0</span> Down
    </div>
      <div class="status-item">
        <strong>Last update:</strong>
        <span id="last-update"><em>Waiting for data…</em></span>
        <span style="color:#2e8b57;"> (from local network)</span>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
      <input
        type="text"
        id="regionSearch"
        placeholder="Search region (type to filter)..."
        autocomplete="off"
        onkeyup="filterRegions()"
      >
    </div>

    <!-- Regions -->
    {% for region, items in results.items() %}
      <div class="region-card" id="region-{{ region.lower().replace(' ', '-') }}">
        <h2>{{ region }}</h2>
        <div class="table-wrapper">
          <table>
            <tr><th>Type</th><th>IP</th><th>Status</th></tr>
            {% for it in items %}
              <tr>
                <td><strong>{{ it.label }}</strong></td>
                <td><code>{{ it.ip }}</code></td>
                <td>
                  <span class="status {{ 'active' if it.status == 'ACTIVE' else 'inactive' }}">
                    {{ it.status }}
                  </span>
                </td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>

      <!-- HIDDEN: Full datetime from pinger (for JS to extract date only) -->
      {% if loop.first %}
        <div id="full-datetime" style="display:none;">{{ last_update }}</div>
      {% endif %}
    {% endfor %}

    <!-- Footer -->
    <div class="footer">
      NHC Network Operations • Auto-refreshes every 15 seconds
    </div>
  </div>

  <script>
    function showOnly(type) {
  const cards = document.querySelectorAll('.region-card');

  cards.forEach(card => {
    let hasMatch = false;

    card.querySelectorAll('table tr').forEach((row, i) => {
      if (i === 0) return; // skip header
      const status = row.querySelector('.status');

      if (status && status.classList.contains(type)) {
        hasMatch = true;
      }
    });

    card.classList.toggle('hidden', !hasMatch);
  });

  // Update counts after filtering
  filterRegions();
}
    // Filter + update counts
    function filterRegions() {
      const query = document.getElementById('regionSearch').value.trim().toLowerCase();
      const cards = document.querySelectorAll('.region-card');
      let active = 0, inactive = 0;

      cards.forEach(card => {
        const regionName = card.querySelector('h2').textContent.toLowerCase();
;
        const matches = query === '' || regionName.includes(query);
        card.classList.toggle('hidden', !matches);
      });

      document.querySelectorAll('table tr:not(:first-child)').forEach(row => {
        const card = row.closest('.region-card');
        if (card && !card.classList.contains('hidden')) {
          const status = row.querySelector('.status');
          if (status && status.classList.contains('active')) active++;
          else if (status) inactive++;
        }
      });

      document.getElementById('active-count').textContent = active;
        document.getElementById('inactive-count').textContent = inactive;
      }

    // Auto-scroll search box when focused
    document.getElementById('regionSearch').addEventListener('focus', function() {
      setTimeout(() => {
        this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 300);
    });

    // Show only DATE from pinger (Tanzania time)
    function updateLastUpdateDate() {
      const fullTime = document.getElementById('full-datetime')?.textContent.trim();
      if (fullTime) {
        // Extract only the date part: "2025-11-11"
        const dateOnly = fullTime.split(' ')[0];
        document.getElementById('last-update').innerHTML = `<strong>${dateOnly}</strong>`;
      }
    }

    // On load
    window.addEventListener('load', () => {
      updateLastUpdateDate();
      filterRegions();
      document.querySelectorAll('.region-card').forEach((card, i) => {
        card.style.animationDelay = `${i * 0.05}s`;
      });
    });
  </script>
</body>
</html>